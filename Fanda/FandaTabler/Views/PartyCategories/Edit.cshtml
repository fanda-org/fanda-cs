@model Fanda.ViewModel.Business.PartyCategoryViewModel

@{
    ViewData["Title"] = "Edit";
}

@*@section Styles {
    <link href="~/vendor/bootstrap4c-custom-switch/css/component-custom-switch.css" rel="stylesheet" />
        }*@

@*@section Breadcrumbs {
        @{
            var breadcrumbs = new Dictionary<string, string>
    ()
    {
    {"Home","/Home" },
    {"Contact Categories","/PartyCategories" },
    {"Contact Category","" }
    };
    ViewBag.Breadcrumbs = breadcrumbs;
    }
    <ol class="breadcrumb">
        <!-- BREADCRUMB-ITEMS -->
        <partial name="_breadcrumb-items" />
        <!-- /BREADCRUMB-ITEMS -->
        <!-- BREADCRUMB-MENU -->
        <partial name="_breadcrumb-menu" />
        <!-- /BREADCRUMB-MENU -->
    </ol>
    }*@

<form asp-action="Edit" method="post">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title"><i class="fe fe-briefcase"></i> Contact Category - @ViewBag.Mode</h3>
        </div>
        <div class="card-body">
            @Html.HiddenFor(model => model.CategoryId)
            <div class="row">
                @if (ViewData.ModelState.Values.Any() && ViewData.ModelState.ErrorCount > 0)
                {
                    <div class="col-md-12">
                        <div class="alert alert-warning alert-dismissible fade show" role="alert">
                            @{

                                foreach (var modelState in ViewData.ModelState.Values)
                                {
                                    foreach (var error in modelState.Errors)
                                    {
                                        <i class="fe fe-alert-triangle" aria-hidden="true"></i> @error.ErrorMessage<br />
                                    }
                                }
                            }
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                @*<span aria-hidden="true">&times;</span>*@
                            </button>
                        </div>
                    </div>
                }
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label asp-for="Code" class="control-label"></label>
                        @if (ViewBag.Readonly)
                        {
                            <input asp-for="Code" class="form-control text-uppercase" readonly />
                        }
                        else
                        {
                            <input asp-for="Code" class="form-control input-uppercase" autofocus />
                        }
                        <span asp-validation-for="Code" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label asp-for="Name" class="control-label"></label>
                        @if (ViewBag.Readonly)
                        {
                            <input asp-for="Name" class="form-control" readonly />
                        }
                        else
                        {
                            <input asp-for="Name" class="form-control" />
                        }
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label asp-for="Description" class="control-label"></label>
                        @if (ViewBag.Readonly)
                        {
                            <input asp-for="Description" class="form-control" readonly />
                        }
                        else
                        {
                            <input asp-for="Description" class="form-control" />
                        }
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label asp-for="Active" class="control-label"></label>
                        <div>
                            <label class="custom-switch">
                                @if (ViewBag.Readonly)
                                {
                                    <input type="checkbox" asp-for="Active" class="custom-switch-input" disabled readonly>
                                }
                                else
                                {
                                    <input type="checkbox" asp-for="Active" class="custom-switch-input">
                                }
                                <span class="custom-switch-indicator"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            @if (ViewBag.Mode != "Create")
            {
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-0">
                            <label asp-for="DateCreated" class="control-label"></label>
                            <input asp-for="DateCreated" class="form-control" type="text" readonly />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-0">
                            <label asp-for="DateModified" class="control-label"></label>
                            <input asp-for="DateModified" class="form-control" type="text" readonly tabindex="-1" />
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="card-footer">
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group mb-0">
                        <a class="btn btn-secondary" data-toggle="tooltip" title="Back to list" asp-action="Index"><i class="fe fe-list"></i> Back</a>
                        <button type="button" id="btnDelete" value="Delete" data-toggle="tooltip" title="Delete" class="btn btn-outline-warning"><i class="fe fe-trash"></i> Delete</button>
                        <div class="float-right">
                            <button type="button" id="btnEdit" value="Edit" data-toggle="tooltip" title="Edit" class="btn btn-secondary"><i class="fe fe-edit"></i> Edit</button>
                            <button type="reset" id="btnCancel" value="Reset" data-toggle="tooltip" title="Cancel changes and continue edit" class="btn btn-secondary"><i class="fe fe-rotate-ccw"></i> Reset</button>
                            <button type="submit" id="btnSave" value="Save" data-toggle="tooltip" title="Save changes" class="btn btn-primary"><i class="fe fe-save"></i> Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

@section Scripts {
    @*@{
            await Html.RenderPartialAsync("_ValidationScriptsPartial");
        }*@

    <script>
        requirejs(["jquery", "sweetalert", "jquery-validation-unobtrusive"], function () {
            //$('body').tooltip({ selector: '[data-toggle="tooltip"]' });

            if ('@ViewBag.Mode' === 'Create')
                $('#btnDelete').hide();
            if ('@ViewBag.Mode' !== 'Create' && '@ViewBag.Mode' !== 'Edit') {
                $('#btnCancel').hide();
                $('#btnSave').hide();
            }
            if ('@ViewBag.Mode' !== 'Details')
                $('#btnEdit').hide();

            $('#btnDelete').click(function () {
                            swal({
                                title: "Are you sure?",
                    text: "Do you want to delete this Contact Category? Once deleted, you will not be able to recover!",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                .then((willDelete) => {
                 if (willDelete) {
                        //var dataType = 'application/x-www-form-urlencoded; charset=utf-8';
                        //var data = $('form').serialize();
                        $.ajax({
                         url: "@Url.Action("DeleteConfirmed")",
                            type: 'POST',
                            //dataType: 'json',
                            //contentType: dataType,
                            data: { id: "@Model.CategoryId" },
                            success: function (data) {
                             if (data.ok) {
                                 console.log('Deleted successfully!');
                                 swal({
                                     title: "Deleted!", text: "Contact category has been deleted!", icon: "success"
                                    })
                                        .then(() => {
                                            window.location = data.url;
                                        });
                        }
                                else {
                            swal("Error! Error while deleting category: " + data.message, {
                                icon: "success",
                                    });
                            //window.location = data.url;
                        }
                    },
                            error: function (res, textStatus, error) {
                        console.log("Error: ", res, textStatus, error);
                        swal("Failed! Error while deleting category: " + error, {
                            icon: "error",
                                });
                    }
                });
                    } else {
                        swal({ title: "Cancelled!", text: "Contact category deletion cancelled!", icon: "info" });
                    }
                });
            });

            $('#btnCancel').click(function () {
                var active = '@Model.Active' == 'True' ? true : false;

                $('#Code').val('@Model.Code');
                $('#Name').val('@Model.Name');
                $('#Description').val('@Model.Description');
                $('#Active').prop('checked', active);
                $('#Code').focus();
            });

            $('#btnEdit').click(function () {
                @*var id = "@Model.CategoryId";
                var url = '@Url.Action("Edit", new { id = "-1" })';
                url = url.replace('-1', id);
                window.location = url;*@
                @{
        ViewBag.Mode = "Edit";
        ViewBag.Readonly = false;
}
                $('#Code').prop('readonly', false);
                $('#Name').prop('readonly', false);
                $('#Description').prop('readonly', false);
                $('#Active').prop('readonly', false);
                $('#Active').prop('disabled', false);

                $('#btnEdit').hide();
                $('#btnCancel').show();
                $('#btnSave').show();

                $('#Code').focus();
            });

            $(document).ajaxSend(function (e, xhr, options) {
                if (options.type.toUpperCase() == "POST") {
                    var token = $("input[name='__RequestVerificationToken']").val();
                    xhr.setRequestHeader("RequestVerificationToken", token);
                }
            });
        });
    </script>
}
